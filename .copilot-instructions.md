# Smart To-Do List Application - Development Instructions

This guide provides comprehensive instructions for building a full stack smart to-do list application using Google Cloud Platform from start to finish.

## Project Overview

Build a modern, intelligent to-do list application with the following features:
- User authentication and authorization
- Smart task categorization and prioritization
- Real-time synchronization across devices
- AI-powered task suggestions and scheduling
- Mobile-responsive web interface
- Cloud-based data storage and backup

## Technology Stack

### Frontend
- **Framework**: React with TypeScript
- **Build Tool**: Vite
- **Styling**: Tailwind CSS
- **State Management**: Zustand
- **UI Components**: Radix UI or Shadcn/ui
- **Authentication**: Firebase Auth or Google Identity

### Backend
- **Runtime**: Node.js with Express.js and TypeScript
- **API**: RESTful API with OpenAPI/Swagger documentation
- **Authentication**: JWT tokens with Google OAuth2
- **File Upload**: Multer for file handling

### Database
- **Primary Database**: Google Cloud SQL (PostgreSQL)
- **Caching**: Google Cloud Memorystore (Redis)
- **File Storage**: Google Cloud Storage

### Cloud Infrastructure
- **Hosting**: Google App Engine (Frontend and Backend)
- **Service Account**: `smartlist@smart-todolist-471817.iam.gserviceaccount.com`
- **API Gateway**: Google Cloud Endpoints (optional)
- **Monitoring**: Google Cloud Monitoring and Logging

## Development Environment Setup

### Prerequisites
1. Install Node.js (v18 or higher)
2. Install Google Cloud CLI (`gcloud`)
3. Install Docker (for local development)
4. Install PostgreSQL locally (for development)

### Initial Project Structure
```
smart-todolist/
├── frontend/                 # React application
├── backend/                  # Express.js API
├── shared/                   # Shared TypeScript types
├── infrastructure/           # Cloud deployment configs
├── docs/                     # Documentation
├── .env.example             # Environment variables template
├── docker-compose.yml       # Local development setup
├── package.json             # Root package.json for scripts
└── README.md
```

## Step 1: Project Initialization

### Create Project Structure
```bash
mkdir smart-todolist
cd smart-todolist

# Initialize root package.json for workspace
npm init -y

# Create frontend with Vite + React + TypeScript
npm create vite@latest frontend -- --template react-ts
cd frontend
npm install
npm install -D tailwindcss postcss autoprefixer @types/node
npx tailwindcss init -p
cd ..

# Create backend with Express + TypeScript
mkdir backend
cd backend
npm init -y
npm install express cors helmet morgan dotenv jsonwebtoken bcryptjs
npm install -D @types/express @types/cors @types/helmet @types/morgan @types/jsonwebtoken @types/bcryptjs @types/node typescript ts-node nodemon
cd ..

# Create shared types package
mkdir shared
cd shared
npm init -y
npm install -D typescript
cd ..
```

### Configure TypeScript
Create `backend/tsconfig.json`:
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

## Step 2: Google Cloud Setup

### Authenticate with Google Cloud
```bash
# Login to Google Cloud
gcloud auth login

# Set project ID (replace with your actual project ID)
gcloud config set project smart-todolist-471817

# Authenticate application default credentials
gcloud auth application-default login
```

### Service Account Configuration
```bash
# Download service account key (if not already available)
gcloud iam service-accounts keys create ./infrastructure/service-account-key.json \
  --iam-account=smartlist@smart-todolist-471817.iam.gserviceaccount.com

# Set environment variable for local development
export GOOGLE_APPLICATION_CREDENTIALS="./infrastructure/service-account-key.json"
```

### Enable Required APIs
```bash
gcloud services enable sqladmin.googleapis.com
gcloud services enable storage.googleapis.com
gcloud services enable appengine.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable secretmanager.googleapis.com
```

## Step 3: Database Setup

### Create Cloud SQL Instance
```bash
# Create PostgreSQL instance
gcloud sql instances create todolist-db \
  --database-version=POSTGRES_14 \
  --tier=db-f1-micro \
  --region=us-central1 \
  --storage-type=SSD \
  --storage-size=10GB

# Create database
gcloud sql databases create smarttodolist --instance=todolist-db

# Create database user
gcloud sql users create todoapp \
  --instance=todolist-db \
  --password=SecurePassword123!
```

### Database Schema
Create `backend/src/database/schema.sql`:
```sql
-- Users table
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password_hash VARCHAR(255),
  google_id VARCHAR(255) UNIQUE,
  name VARCHAR(255) NOT NULL,
  avatar_url VARCHAR(255),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Categories table
CREATE TABLE categories (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  name VARCHAR(100) NOT NULL,
  color VARCHAR(7) DEFAULT '#3B82F6',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tasks table
CREATE TABLE tasks (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  category_id INTEGER REFERENCES categories(id) ON DELETE SET NULL,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  priority INTEGER DEFAULT 1 CHECK (priority BETWEEN 1 AND 5),
  status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled')),
  due_date TIMESTAMP,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Task attachments table
CREATE TABLE task_attachments (
  id SERIAL PRIMARY KEY,
  task_id INTEGER REFERENCES tasks(id) ON DELETE CASCADE,
  filename VARCHAR(255) NOT NULL,
  file_url VARCHAR(500) NOT NULL,
  file_size INTEGER,
  mime_type VARCHAR(100),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for performance
CREATE INDEX idx_tasks_user_id ON tasks(user_id);
CREATE INDEX idx_tasks_status ON tasks(status);
CREATE INDEX idx_tasks_due_date ON tasks(due_date);
CREATE INDEX idx_categories_user_id ON categories(user_id);
```

## Step 4: Backend Development

### Environment Configuration
Create `backend/.env.example`:
```
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=smarttodolist
DB_USER=todoapp
DB_PASSWORD=SecurePassword123!

# Google Cloud
GOOGLE_APPLICATION_CREDENTIALS=../infrastructure/service-account-key.json
GCS_BUCKET_NAME=smart-todolist-files

# Authentication
JWT_SECRET=your-super-secret-jwt-key-here
GOOGLE_CLIENT_ID=your-google-oauth-client-id
GOOGLE_CLIENT_SECRET=your-google-oauth-client-secret

# Server
PORT=3001
NODE_ENV=development
CORS_ORIGIN=http://localhost:5173
```

### Database Connection
Create `backend/src/database/connection.ts`:
```typescript
import { Pool } from 'pg';

const pool = new Pool({
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT || '5432'),
  database: process.env.DB_NAME,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,
});

export default pool;
```

### API Routes Structure
Create the following API endpoints:

#### Authentication Routes (`backend/src/routes/auth.ts`)
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/google` - Google OAuth login
- `POST /api/auth/refresh` - Refresh JWT token
- `POST /api/auth/logout` - User logout

#### Task Routes (`backend/src/routes/tasks.ts`)
- `GET /api/tasks` - Get user's tasks with filtering/pagination
- `POST /api/tasks` - Create new task
- `GET /api/tasks/:id` - Get specific task
- `PUT /api/tasks/:id` - Update task
- `DELETE /api/tasks/:id` - Delete task
- `POST /api/tasks/:id/attachments` - Upload task attachment

#### Category Routes (`backend/src/routes/categories.ts`)
- `GET /api/categories` - Get user's categories
- `POST /api/categories` - Create new category
- `PUT /api/categories/:id` - Update category
- `DELETE /api/categories/:id` - Delete category

#### User Routes (`backend/src/routes/users.ts`)
- `GET /api/users/profile` - Get user profile
- `PUT /api/users/profile` - Update user profile
- `DELETE /api/users/account` - Delete user account

### Middleware Setup
Create `backend/src/middleware/auth.ts`:
```typescript
import { Request, Response, NextFunction } from 'express';
import jwt from 'jsonwebtoken';

export interface AuthRequest extends Request {
  user?: { id: number; email: string };
}

export const authenticate = (req: AuthRequest, res: Response, next: NextFunction) => {
  const token = req.header('Authorization')?.replace('Bearer ', '');

  if (!token) {
    return res.status(401).json({ error: 'Access denied. No token provided.' });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET!) as any;
    req.user = decoded;
    next();
  } catch (error) {
    res.status(400).json({ error: 'Invalid token.' });
  }
};
```

## Step 5: Frontend Development

### UI Component Setup
Install additional frontend dependencies:
```bash
cd frontend
npm install @radix-ui/react-dialog @radix-ui/react-dropdown-menu @radix-ui/react-select
npm install lucide-react date-fns axios react-hook-form @hookform/resolvers zod
npm install zustand react-router-dom
```

### State Management
Create `frontend/src/store/todoStore.ts`:
```typescript
import { create } from 'zustand';

interface Task {
  id: number;
  title: string;
  description?: string;
  priority: number;
  status: 'pending' | 'in_progress' | 'completed' | 'cancelled';
  due_date?: string;
  category_id?: number;
  created_at: string;
  updated_at: string;
}

interface Category {
  id: number;
  name: string;
  color: string;
}

interface TodoStore {
  tasks: Task[];
  categories: Category[];
  loading: boolean;
  error: string | null;
  
  // Actions
  fetchTasks: () => Promise<void>;
  createTask: (task: Omit<Task, 'id' | 'created_at' | 'updated_at'>) => Promise<void>;
  updateTask: (id: number, task: Partial<Task>) => Promise<void>;
  deleteTask: (id: number) => Promise<void>;
  fetchCategories: () => Promise<void>;
  createCategory: (category: Omit<Category, 'id'>) => Promise<void>;
}

export const useTodoStore = create<TodoStore>((set, get) => ({
  tasks: [],
  categories: [],
  loading: false,
  error: null,
  
  fetchTasks: async () => {
    // Implementation with API calls
  },
  
  createTask: async (taskData) => {
    // Implementation with API calls
  },
  
  updateTask: async (id, taskData) => {
    // Implementation with API calls
  },
  
  deleteTask: async (id) => {
    // Implementation with API calls
  },
  
  fetchCategories: async () => {
    // Implementation with API calls
  },
  
  createCategory: async (categoryData) => {
    // Implementation with API calls
  },
}));
```

### Key Components to Implement
1. `TaskList.tsx` - Main task display component
2. `TaskItem.tsx` - Individual task component
3. `TaskForm.tsx` - Task creation/editing form
4. `CategoryManager.tsx` - Category management
5. `AuthForm.tsx` - Login/registration forms
6. `Dashboard.tsx` - Main application dashboard

## Step 6: Cloud Storage Setup

### Google Cloud Storage Configuration
Create `backend/src/services/storage.ts`:
```typescript
import { Storage } from '@google-cloud/storage';

const storage = new Storage({
  keyFilename: process.env.GOOGLE_APPLICATION_CREDENTIALS,
  projectId: 'smart-todolist-471817',
});

const bucketName = process.env.GCS_BUCKET_NAME || 'smart-todolist-files';
const bucket = storage.bucket(bucketName);

export const uploadFile = async (file: Express.Multer.File, fileName: string) => {
  const blob = bucket.file(fileName);
  const blobStream = blob.createWriteStream({
    resumable: false,
    metadata: {
      contentType: file.mimetype,
    },
  });

  return new Promise((resolve, reject) => {
    blobStream.on('error', reject);
    blobStream.on('finish', () => {
      const publicUrl = `https://storage.googleapis.com/${bucketName}/${fileName}`;
      resolve(publicUrl);
    });
    blobStream.end(file.buffer);
  });
};
```

### Create Storage Bucket
```bash
# Create bucket for file storage
gsutil mb gs://smart-todolist-files

# Set bucket permissions
gsutil iam ch serviceAccount:smartlist@smart-todolist-471817.iam.gserviceaccount.com:objectAdmin gs://smart-todolist-files
```

## Step 7: Deployment Configuration

### App Engine Configuration
Create `backend/app.yaml`:
```yaml
runtime: nodejs18

env_variables:
  DB_HOST: "/cloudsql/smart-todolist-471817:us-central1:todolist-db"
  DB_NAME: "smarttodolist"
  DB_USER: "todoapp"
  NODE_ENV: "production"
  GCS_BUCKET_NAME: "smart-todolist-files"

automatic_scaling:
  min_instances: 1
  max_instances: 10

resources:
  cpu: 1
  memory_gb: 0.5
  disk_size_gb: 10
```

Create `frontend/app.yaml`:
```yaml
runtime: nodejs18

handlers:
- url: /static
  static_dir: dist/assets

- url: /.*
  static_files: dist/index.html
  upload: dist/index.html

automatic_scaling:
  min_instances: 1
  max_instances: 5
```

### Build Scripts
Update root `package.json`:
```json
{
  "name": "smart-todolist",
  "private": true,
  "scripts": {
    "dev": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "cd frontend && npm run dev",
    "build": "npm run build:frontend && npm run build:backend",
    "build:frontend": "cd frontend && npm run build",
    "build:backend": "cd backend && npm run build",
    "deploy": "npm run deploy:backend && npm run deploy:frontend",
    "deploy:backend": "cd backend && gcloud app deploy",
    "deploy:frontend": "cd frontend && npm run build && gcloud app deploy",
    "test": "npm run test:backend && npm run test:frontend",
    "test:backend": "cd backend && npm test",
    "test:frontend": "cd frontend && npm test"
  },
  "devDependencies": {
    "concurrently": "^7.6.0"
  }
}
```

## Step 8: Development Workflow

### Local Development Setup
```bash
# Install all dependencies
npm install
cd frontend && npm install && cd ..
cd backend && npm install && cd ..

# Set up environment variables
cp backend/.env.example backend/.env
# Edit backend/.env with your actual values

# Start local development
npm run dev
```

### Database Migration Strategy
Create `backend/src/migrations/` directory for database migrations:
```bash
# Run initial schema
psql -h localhost -U todoapp -d smarttodolist -f backend/src/database/schema.sql

# For production, use Cloud SQL Proxy
cloud_sql_proxy -instances=smart-todolist-471817:us-central1:todolist-db=tcp:5432
```

## Step 9: Security and Authentication

### Google OAuth Setup
1. Go to Google Cloud Console
2. Enable Google+ API
3. Create OAuth 2.0 credentials
4. Add authorized domains and redirect URIs
5. Update environment variables with client ID and secret

### Security Headers and CORS
Implement in `backend/src/app.ts`:
```typescript
import helmet from 'helmet';
import cors from 'cors';

app.use(helmet());
app.use(cors({
  origin: process.env.CORS_ORIGIN?.split(',') || 'http://localhost:5173',
  credentials: true,
}));
```

## Step 10: Testing Strategy

### Backend Testing
```bash
cd backend
npm install -D jest @types/jest supertest @types/supertest
```

Create test files:
- `__tests__/auth.test.ts`
- `__tests__/tasks.test.ts`
- `__tests__/categories.test.ts`

### Frontend Testing
```bash
cd frontend
npm install -D vitest @testing-library/react @testing-library/jest-dom
```

## Step 11: Monitoring and Logging

### Cloud Monitoring Setup
```typescript
// backend/src/middleware/logging.ts
import { createLogger, format, transports } from 'winston';

const logger = createLogger({
  level: 'info',
  format: format.combine(
    format.timestamp(),
    format.errors({ stack: true }),
    format.json()
  ),
  defaultMeta: { service: 'smart-todolist-api' },
  transports: [
    new transports.File({ filename: 'error.log', level: 'error' }),
    new transports.File({ filename: 'combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new transports.Console({
    format: format.simple()
  }));
}

export default logger;
```

## Development Guidelines

### Code Quality
- Use ESLint and Prettier for code formatting
- Implement TypeScript strict mode
- Write unit tests for critical functionality
- Use proper error handling and logging
- Implement proper validation with Zod or Joi

### Performance Optimization
- Implement pagination for task lists
- Use database indexes appropriately
- Implement caching with Redis for frequently accessed data
- Optimize bundle size with code splitting
- Implement lazy loading for components

### Security Best Practices
- Validate all inputs on both client and server
- Use HTTPS in production
- Implement rate limiting
- Store sensitive data in Google Secret Manager
- Regular security audits of dependencies

## Deployment Checklist

Before deploying to production:
- [ ] Environment variables configured in App Engine
- [ ] Database migrations applied
- [ ] Google Cloud APIs enabled
- [ ] Service account permissions verified
- [ ] SSL/TLS certificates configured
- [ ] Domain name configured (if applicable)
- [ ] Monitoring and alerting set up
- [ ] Backup strategy implemented
- [ ] Load testing completed

## Maintenance and Updates

### Regular Tasks
- Monitor application performance and logs
- Update dependencies regularly
- Backup database regularly
- Review and rotate API keys and secrets
- Monitor Google Cloud resource usage and costs

### Scaling Considerations
- Database connection pooling optimization
- Implement Cloud CDN for static assets
- Consider Cloud Run for containerized deployment
- Implement horizontal scaling with load balancers

This comprehensive guide provides the foundation for building a full-featured smart to-do list application on Google Cloud Platform. Follow each step carefully and adapt the configurations to your specific needs.